

<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="docsearch:name" content="Tripy" />
    <meta name="docsearch:package_type" content="" />
    <meta name="docsearch:release" content="0.0.1" />
    <meta name="docsearch:version" content="0.0.1" />
    
      <title>tripy.backend.compiler_api &mdash; Tripy 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/bootstrap-icons.css" type="text/css" />
          <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=3d3fbe02" />
          <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
          <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../../../_static/pygments_dark.css?v=b20cc3f5" />
          <link rel="stylesheet" type="text/css" href="../../../_static/colorsets/sphinx-nefertiti-green.min.css" />
          <link rel="stylesheet" type="text/css" href="../../../_static/fonts/nunito/stylesheet.css" />
          <link rel="stylesheet" type="text/css" href="../../../_static/fonts/red-hat-mono/stylesheet.css" />
          <link rel="stylesheet" type="text/css" href="../../../_static/pygments_dark.css?v=b20cc3f5" />
          <link rel="stylesheet" type="text/css" href="../../../_static/style.css?v=270043a8" />
        <link rel="index" title="Index" href="../../../genindex.html" />
        <link rel="search" title="Search" href="../../../search.html" />
        <link rel="top" title="Tripy 0.0.1 documentation" href="#" />
        <link rel="up" title="Module code" href="../../index.html" />
    <style>
      :root {
        --nftt-body-font-family: "Nunito", var(--nftt-font-sans-serif) !important;
        --nftt-font-monospace: "Red Hat Mono", var(--nftt-font-family-monospace) !important;
        --nftt-project-name-font: var(--nftt-body-font-family);
        --nftt-documentation-font: var(--nftt-body-font-family);
        --nftt-doc-headers-font: "Georgia", var(--nftt-documentation-font);--nftt-documentation-font-size: 1.0rem;--nftt-monospace-font-size: 0.85rem;}
      h1 *, h2 *, h3 *, h4 *, h5 *, h6 * { font-size: inherit; }
    </style>
  </head>
  <body>
    <header class="navbar navbar-expand-lg navbar-dark nftt-navbar flex-column fixed-top">
      <div class="skip-links container-xxl visually-hidden-focusable overflow-hidden justify-content-start">
        <div class="border-bottom mb-2 pb-2 w-100">
          <a class="d-none d-md-inline-flex p-2 m-1" href="#sidebar-filter">Skip to docs navigation</a>
          <a class="d-inline-flex p-2 m-1" href="#content">Skip to main content</a>
        </div>
      </div>
      <nav class="container-xxl nftt-gutter flex-wrap flex-lg-nowrap" aria-label="Main navigation">
        <div class="nftt-navbar-toggler">
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar" aria-controls="sidebar" aria-label="Toggle documentation navigation">
            <i class="bi bi-list"></i>
          </button>
        </div>
          <a href="../../../index.html"
              
              class="navbar-brand p-0 me-0 md-lg-2"
          ><span class="brand-text">Tripy</span></a>
        
        <div class="d-flex d-lg-none">
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#nfttSearch" aria-controls="nfttSearch" aria-label="Search">
            <i class="bi bi-search"></i>
          </button>
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#nfttNavbar" aria-controls="nfttNavbar" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
        </div>
        
<div class="offcanvas-lg offcanvas-end flex-grow-1" tabindex="-1" id="nfttSearch" aria-labelledby="nfttSearchOffcanvasLabel" data-bs-scroll="true">
  <div class="offcanvas-header px-4 pb-0">
    <h5 class="offcanvas-title fw-bold" id="nfttSearchOffcanvasLabel">Search the documentation</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#nfttSearch"></button>
  </div>
  <div class="offcanvas-body p-4 pt-0 p-lg-0 px-lg-3">
    <hr class="d-lg-none text-white-50">
    <ul class="navbar-nav flex-row align-items-center flex-wrap ms-md-auto">
      <li class="nav-item col-12 col-lg-auto">
        <form id="nftt-search-form" action="../../../search.html" method="get">
          <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="Search docs" aria-label="Search" aria-describedby="button-search">
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <button class="btn btn-primary" type="submit" id="button-search" aria-label="Search"><i class="bi bi-search"></i></button>
          </div>
        </form>
      </li>
    </ul>
  </div>
</div>

        <div class="offcanvas-lg offcanvas-end" tabindex="-1" id="nfttNavbar" aria-labelledby="nfttNavbarOffcanvasLabel" data-bs-scroll="true">
          <div class="offcanvas-header px-4 pb-0">
            <div class="offcanvas-title text-white fw-bold" id="nfttNavbarOffcanvasLabel"><span class="brand-text">Nefertiti for Sphinx</span></div>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#nfttNavbar"></button>
          </div>
          <div class="offcanvas-body p-4 pt-0 p-lg-0">
            <hr class="d-lg-none text-white-50">
            <ul class="navbar-nav flex-row align-items-center flex-wrap ms-md-auto">
              
              <li class="nav-item col-12 col-lg-auto">
                <a class="nav-link py-2 py-lg-0 px-0 px-lg-2" href="https://github.com/NVIDIA/TensorRT-Incubator" target="_blank" rel="noopener">
                  <div class="d-flex align-items-center">
                    <div class="me-2">
                      <i class="bi bi-git size-24"></i>
                    </div>
                    <div class="repo d-flex flex-column align-items-center" data-snftt-repo-url="https://github.com/NVIDIA/TensorRT-Incubator">
                      Tripy
                      <div class="d-flex justify-content-center" data-snftt-repo-metrics>
                        <span class="pe-2 d-flex justify-content-center align-items-center">
                          <i class="bi bi-tag size-14"></i>
                          <span class="repo-metric" data-snftt-repo-tag></span>
                        </span>
                        <span class="pe-2 d-flex justify-content-center align-items-center">
                          <i class="bi bi-star size-14"></i>
                          <span class="repo-metric" data-snftt-repo-stars></span>
                        </span>
                        <span class="d-flex justify-content-center align-items-center">
                          <i class="bi bi-diagram-2 size-14"></i>
                          <span class="repo-metric" data-snftt-repo-forks></span>
                        </span>
                      </div>
                    </div>
                  </div>
                </a>
              </li>
              <li class="nav-item col-12 col-lg-auto h-100" aria-hidden="true">
                <div class="vr d-none d-lg-flex h-100 mx-lg-2 text-white"></div>
                <hr class="d-lg-none text-white-50">
              </li>
              
              <!-- version_dropdown.html -->

              
              <!-- colorscheme_dropdown.html -->
<li class="nav-item dropdown">
  <a class="nav-link d-flex py-2 px-0 px-lg-2 dropdown-toggle align-items-center" id="snftt-luz" href="#" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false" aria-label="Toggle light/dark">
    <i class="bi bi-circle-half" data-snftt-luz-icon-active></i>
    <span id="snftt-luz-text" class="d-lg-none small ms-2">Toggle light/dark</span>
  </a>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="snftt-luz-text">
    <li>
      <h6 class="dropdown-header">Light/dark</h6>
    </li>
    <li>
      <a class="dropdown-item d-flex align-items-center" data-snftt-luz="light" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-sun" data-snftt-luz-icon="light"></i>
        </span>
        <span class="small ms-3">Light</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
    <li>
      <a class="dropdown-item d-flex align-items-center" data-snftt-luz="dark" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-moon-stars" data-snftt-luz-icon="dark"></i>
        </span>
        <span class="small ms-3">Dark</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
    <li>
      <a class="dropdown-item current d-flex align-items-center" data-snftt-luz="default" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-circle-half" data-snftt-luz-icon="default"></i>
        </span>
        <span class="small ms-3">Default</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
  </ul>
</li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <div class="container-xxl nftt-gutter nftt-layout">
      <aside class="nftt-sidebar">
        <div class="title d-none d-md-block">
          <i class="bi bi-book"></i>&nbsp;&nbsp;<span>Table of contents</span>
        </div>
        <div id="sidebar" tabindex="-1" class="offcanvas-lg offcanvas-start" aria-labelledby="nfttSidebarOffcanvasLabel">
            <!-- danirus sidebartemplate: "globaltoc.html" --><div class="offcanvas-header border-bottom">
  <h5 class="offcanvas-title" id="nfttSidebarOffcanvasLabel">
    Table of contents
  </h5>
  <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#sidebar"></button>
</div>

<div class="offcanvas-body">
  <nav class="toc" aria-label="Main menu">
    <div class="mb-3 p-1 pt-3 pb-4 border-bottom">
      <input id="sidebar-filter" type="text" name="filter" class="form-control form-control-sm" placeholder="filter" aria-label="filter">
    </div>
    <p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../pre0_user_guides/introduction-to-tripy.html">An Introduction To Tripy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pre0_user_guides/quantization.html">Quantization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../compiler/index.html">Compiler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../compiler/arg_info.html">ArgInfo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../compiler/executable.html">Executable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../compiler/input_info.html">InputInfo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../config.html">config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../datatype.html">dtype</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../device.html">device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../exception/index.html">Exception</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../exception/tripy_exception.html">TripyException</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../logger.html">logger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/index.html">Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/conv.html">Conv</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/conv_transpose.html">ConvTranspose</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/embedding.html">Embedding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/group_norm.html">GroupNorm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/layer_norm.html">LayerNorm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/linear.html">Linear</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/parameter.html">Parameter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../shape.html">Shape</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tensor/index.html">Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tensor_operations/index.html">Tensor Operations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/abs.html">abs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/all.html">all</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/allclose.html">allclose</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/any.html">any</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/arange.html">arange</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/argmax.html">argmax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/argmin.html">argmin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/cast.html">cast</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/concatenate.html">concatenate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/copy.html">copy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/cos.html">cos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/dequantize.html">dequantize</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/exp.html">exp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/expand.html">expand</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/flip.html">flip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/full.html">full</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/full_like.html">full_like</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/gather.html">gather</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/gelu.html">gelu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/iota.html">iota</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/iota_like.html">iota_like</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/log.html">log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/masked_fill.html">masked_fill</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/max.html">max</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/maximum.html">maximum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/mean.html">mean</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/minimum.html">minimum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/ones.html">ones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/ones_like.html">ones_like</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/permute.html">permute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/plugin.html">plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/prod.html">prod</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/quantize.html">quantize</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/relu.html">relu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/reshape.html">reshape</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/rsqrt.html">rsqrt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/sigmoid.html">sigmoid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/silu.html">silu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/sin.html">sin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/softmax.html">softmax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/split.html">split</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/sqrt.html">sqrt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/squeeze.html">squeeze</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/sum.html">sum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/tanh.html">tanh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/transpose.html">transpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/tril.html">tril</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/triu.html">triu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/unsqueeze.html">unsqueeze</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/var.html">var</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/where.html">where</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/zeros.html">zeros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tensor_operations/zeros_like.html">zeros_like</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../post0_developer_guides/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../post0_developer_guides/debugging.html">Debugging MLIR-TensorRT backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../post0_developer_guides/design-decisions.html">Design Decisions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../post0_developer_guides/how-to-add-new-ops.html">Adding New Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../post0_developer_guides/mlir-dialect-python-apis.html">Using Python APIs of MLIR Dialects</a></li>
</ul>

  </nav>
  <template data-toggle-item-template>
    <button class="btn btn-sm btn-link toctree-expand" type="button">
      <i class="bi bi-caret-right"></i>
      <span class="visually-hidden">Toggle menu contents</span>
    </button>
  </template>
</div>
        </div>
      </aside>
      <main class="nftt-main">
        <article id="content" class="nftt-content" role="main">
    <h1>Source code for tripy.backend.compiler_api</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># SPDX-FileCopyrightText: Copyright (c) 1993-2024 NVIDIA CORPORATION &amp; AFFILIATES. All rights reserved.</span>
<span class="c1"># SPDX-License-Identifier: Apache-2.0</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1"># http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">numbers</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">mlir_tensorrt.runtime.api</span> <span class="k">as</span> <span class="nn">runtime</span>

<span class="kn">from</span> <span class="nn">tripy</span> <span class="kn">import</span> <span class="n">export</span><span class="p">,</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">tripy.backend.mlir</span> <span class="kn">import</span> <span class="n">Compiler</span> <span class="k">as</span> <span class="n">MLIRCompiler</span>
<span class="kn">from</span> <span class="nn">tripy.backend.mlir</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">tripy.backend.mlir</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">mlir_utils</span>
<span class="kn">from</span> <span class="nn">tripy.common.exception</span> <span class="kn">import</span> <span class="n">raise_error</span>
<span class="kn">from</span> <span class="nn">tripy.common.shape_bounds</span> <span class="kn">import</span> <span class="n">ShapeBounds</span>
<span class="kn">from</span> <span class="nn">tripy.frontend</span> <span class="kn">import</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">Trace</span>
<span class="kn">from</span> <span class="nn">tripy.utils</span> <span class="kn">import</span> <span class="n">json</span> <span class="k">as</span> <span class="n">json_utils</span>


<div class="viewcode-block" id="InputInfo">
<a class="viewcode-back" href="../../../compiler/input_info.html#tripy.InputInfo">[docs]</a>
<span class="nd">@export</span><span class="o">.</span><span class="n">public_api</span><span class="p">(</span><span class="n">document_under</span><span class="o">=</span><span class="s2">&quot;compiler&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">InputInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Captures information about an input to a compiled function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">dtype</span><span class="p">:</span> <span class="s2">&quot;tripy.dtype&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            shape: The shape of the input.</span>
<span class="sd">                To indicate dynamic dimensions, provide the minimum, optimum, and maximum values for the dimension.</span>
<span class="sd">            dtype: The data type of the input.</span>

<span class="sd">        .. code-block:: python</span>
<span class="sd">            :linenos:</span>
<span class="sd">            :caption: Example</span>

<span class="sd">            inp = tp.InputInfo((2, 4), dtype=tp.float32)</span>
<span class="sd">            assert inp.shape_bounds.min == (2, 4)</span>
<span class="sd">            assert inp.shape_bounds.opt == (2, 4)</span>
<span class="sd">            assert inp.shape_bounds.max == (2, 4)</span>

<span class="sd">        .. code-block:: python</span>
<span class="sd">            :linenos:</span>
<span class="sd">            :caption: Dynamic Dimensions</span>

<span class="sd">            # The first dimension will support values in the range [1, 3], optimizing for a size of 2.</span>
<span class="sd">            inp = tp.InputInfo(((1, 2, 3), 4), dtype=tp.float32)</span>
<span class="sd">            assert inp.shape_bounds.min == (1, 4)</span>
<span class="sd">            assert inp.shape_bounds.opt == (2, 4)</span>
<span class="sd">            assert inp.shape_bounds.max == (3, 4)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO (#252): Allow `shape` to be a shape tensor</span>
        <span class="n">min_shape</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">opt_shape</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_shape</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
                <span class="n">elem</span> <span class="o">=</span> <span class="p">(</span><span class="n">elem</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">3</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">):</span>
                    <span class="n">raise_error</span><span class="p">(</span>
                        <span class="s2">&quot;Shape values must be numbers.&quot;</span><span class="p">,</span>
                        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Shape: </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s2"> contains an element: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="si">}</span><span class="s2"> with non-numerical value(s)&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">raise_error</span><span class="p">(</span>
                        <span class="s2">&quot;Incorrect number of shape values provided.&quot;</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="sa">f</span><span class="s2">&quot;Exactly 3 shape values must be provided for each dimension (min/opt/max)&quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; but got: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="si">}</span><span class="s2"> values in shape: </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s2">. &quot;</span>
                        <span class="p">],</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">raise_error</span><span class="p">(</span>
                    <span class="s2">&quot;Shape values should be either a single number or a Tuple specifying min/opt/max bounds.&quot;</span><span class="p">,</span>
                    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Shape: </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s2"> contains an invalid element: </span><span class="si">{</span><span class="n">elem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                <span class="p">)</span>

            <span class="n">min_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">opt_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">max_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shape_bounds</span> <span class="o">=</span> <span class="n">ShapeBounds</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">min_shape</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">opt_shape</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">max_shape</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;InputInfo(min=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_bounds</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">, opt=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_bounds</span><span class="o">.</span><span class="n">opt</span><span class="si">}</span><span class="s2">, max=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_bounds</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">, dtype=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">)&quot;</span></div>



<span class="c1"># TODO(MLIR-TRT #923): Can generalize `InputInfo` and drop this class.</span>
<div class="viewcode-block" id="ArgInfo">
<a class="viewcode-back" href="../../../compiler/arg_info.html#tripy.ArgInfo">[docs]</a>
<span class="nd">@export</span><span class="o">.</span><span class="n">public_api</span><span class="p">(</span><span class="n">document_under</span><span class="o">=</span><span class="s2">&quot;compiler&quot;</span><span class="p">)</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ArgInfo</span><span class="p">:</span>
    <span class="n">shape_bounds</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A sequence of tuple(min, max) indicating the bounds of each dimension&quot;&quot;&quot;</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="s2">&quot;tripy.dtype&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The datatype of the argument&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Executable">
<a class="viewcode-back" href="../../../compiler/executable.html#tripy.Executable">[docs]</a>
<span class="nd">@export</span><span class="o">.</span><span class="n">public_api</span><span class="p">(</span><span class="n">document_under</span><span class="o">=</span><span class="s2">&quot;compiler&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Executable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a compiled executable generated by the compiler.</span>

<span class="sd">    .. seealso:: :class:`Compiler`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># The constructor is intentionally undocumented because it is not meant to be called by users.</span>
    <span class="c1"># TODO(#155): output_devices is not needed after they can be queried from executable</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">executable</span><span class="p">,</span> <span class="n">arg_names</span><span class="p">,</span> <span class="n">output_devices</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executable</span> <span class="o">=</span> <span class="n">executable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_executable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arg_names</span> <span class="o">=</span> <span class="n">arg_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_devices</span> <span class="o">=</span> <span class="n">output_devices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executable_signature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable</span><span class="o">.</span><span class="n">get_signature</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">)</span>

        <span class="c1"># Build a signature so the executable works with `inspect.signature`</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arg_names</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">POSITIONAL_OR_KEYWORD</span><span class="p">,</span> <span class="n">annotation</span><span class="o">=</span><span class="n">Tensor</span><span class="p">))</span>

        <span class="n">return_annotation</span> <span class="o">=</span> <span class="n">Tensor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_signature</span><span class="o">.</span><span class="n">get_num_output_args</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__signature__</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">return_annotation</span><span class="o">=</span><span class="n">return_annotation</span><span class="p">)</span>

<div class="viewcode-block" id="Executable.__call__">
<a class="viewcode-back" href="../../../compiler/executable.html#tripy.Executable.__call__">[docs]</a>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Invokes the executable with the specified tensor arguments.</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Positional arguments. Must be of type :class:`Tensor` .</span>
<span class="sd">            **kwargs: Keyword arguments. Must be of type :class:`Tensor` .</span>

<span class="sd">        Returns:</span>
<span class="sd">            The output :class:`Tensor` s of the compiled function.</span>


<span class="sd">        .. code-block:: python</span>
<span class="sd">            :linenos:</span>
<span class="sd">            :caption: Example</span>

<span class="sd">            def add(a, b):</span>
<span class="sd">                return a + b</span>

<span class="sd">            # doc: no-print-locals compiler compiled_add</span>
<span class="sd">            compiler = tp.Compiler(add)</span>
<span class="sd">            compiled_add = compiler.compile(tp.InputInfo((1,), dtype=tp.float32), tp.InputInfo((1,), dtype=tp.float32))</span>

<span class="sd">            a = tp.ones((1,), dtype=tp.float32)</span>
<span class="sd">            b = tp.ones((1,), dtype=tp.float32)</span>

<span class="sd">            out = compiled_add(a, b)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_tensors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">input_tensors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="c1"># Need to get arguments in the order of self._arg_names, which may be different from kwargs ordering.</span>
        <span class="n">expected_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arg_names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">:]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">expected_kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">raise_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing argument: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Expected the following arguments: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_arg_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>

            <span class="n">input_tensors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">raise_error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Extra keyword arguments: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected the following arguments: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_arg_names</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Note: The following arguments were already provided as positional arguments: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_arg_names</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">],</span>
            <span class="p">)</span>

        <span class="c1"># We do this after kwarg checks since those will be more informative (we can explain which arguments are missing/extra).</span>
        <span class="n">num_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">num_args</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arg_names</span><span class="p">):</span>
            <span class="n">raise_error</span><span class="p">(</span>
                <span class="s2">&quot;Incorrect number of arguments.&quot;</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arg_names</span><span class="p">)</span><span class="si">}</span><span class="s2"> arguments but got </span><span class="si">{</span><span class="n">num_args</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Note: Expected arguments were: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_arg_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">)</span>

        <span class="c1"># The executor expects concrete tensors as inputs, so we need to eval() here.</span>
        <span class="k">for</span> <span class="n">tensor</span> <span class="ow">in</span> <span class="n">input_tensors</span><span class="p">:</span>
            <span class="n">tensor</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">executor_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_devices</span><span class="p">,</span> <span class="n">input_tensors</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">runtime</span><span class="o">.</span><span class="n">MTRTException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="c1"># TODO: Evaluate whether this should be moved into the executor</span>
            <span class="k">if</span> <span class="s2">&quot;function expects a memref type with element type&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">):</span>
                <span class="c1"># If the problem is a mismatched data type, we can provide a better error message than the executor can.</span>
                <span class="n">expected_input_dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">dtype</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_input_info</span><span class="p">()]</span>
                <span class="k">for</span> <span class="n">tensor</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">arg_name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">input_tensors</span><span class="p">,</span> <span class="n">expected_input_dtypes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arg_names</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">tensor</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">dtype</span><span class="p">:</span>
                        <span class="n">raise_error</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Unexpected tensor data type.&quot;</span><span class="p">,</span>
                            <span class="p">[</span>
                                <span class="sa">f</span><span class="s2">&quot;For parameter </span><span class="si">{</span><span class="n">arg_name</span><span class="si">}</span><span class="s2">, expected data type: </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> but got: </span><span class="si">{</span><span class="n">tensor</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">. Note: Argument was: &quot;</span><span class="p">,</span>
                                <span class="n">tensor</span><span class="p">,</span>
                            <span class="p">],</span>
                        <span class="p">)</span>
            <span class="k">raise</span>

        <span class="c1"># TODO (#192): avoid get_stack_info in runtime</span>
        <span class="n">output_tensors</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tensor</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">executor_outputs</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_tensors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">output_tensors</span> <span class="o">=</span> <span class="n">output_tensors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">output_tensors</span></div>


    <span class="k">def</span> <span class="nf">_get_arg_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_signature</span><span class="o">.</span><span class="n">get_arg</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">.</span><span class="n">MemRefType</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="n">arg_bound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_signature</span><span class="o">.</span><span class="n">get_arg_bound</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">shape_bounds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">arg_bound</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">arg_bound</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">ArgInfo</span><span class="p">(</span><span class="n">shape_bounds</span><span class="p">,</span> <span class="n">mlir_utils</span><span class="o">.</span><span class="n">convert_runtime_dtype_to_tripy_dtype</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

<div class="viewcode-block" id="Executable.get_input_info">
<a class="viewcode-back" href="../../../compiler/executable.html#tripy.Executable.get_input_info">[docs]</a>
    <span class="k">def</span> <span class="nf">get_input_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ArgInfo</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns input tensors&#39; information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list containing one `ArgInfo` per input.</span>

<span class="sd">        .. code-block:: python</span>
<span class="sd">            :linenos:</span>
<span class="sd">            :caption: Get input info</span>

<span class="sd">            def add(a, b):</span>
<span class="sd">                return a + b</span>

<span class="sd">            # doc: no-print-locals compiler compiled_add</span>
<span class="sd">            compiler = tp.Compiler(add)</span>
<span class="sd">            compiled_add = compiler.compile(tp.InputInfo(([1, 2, 3],), dtype=tp.float32), tp.InputInfo(([1, 2, 3],), dtype=tp.float32))</span>
<span class="sd">            print(compiled_add.get_input_info())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_executable_signature</span><span class="o">.</span><span class="n">get_num_input_args</span><span class="p">()):</span>
            <span class="n">input_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_arg_info</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">input_info</span></div>


<div class="viewcode-block" id="Executable.get_output_info">
<a class="viewcode-back" href="../../../compiler/executable.html#tripy.Executable.get_output_info">[docs]</a>
    <span class="k">def</span> <span class="nf">get_output_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ArgInfo</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns output tensors&#39; information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list containing one `ArgInfo` per input.</span>

<span class="sd">        .. code-block:: python</span>
<span class="sd">            :linenos:</span>
<span class="sd">            :caption: Get output info</span>

<span class="sd">            def add(a, b):</span>
<span class="sd">                return a + b</span>

<span class="sd">            # doc: no-print-locals compiler compiled_add</span>
<span class="sd">            compiler = tp.Compiler(add)</span>
<span class="sd">            compiled_add = compiler.compile(tp.InputInfo(([1, 2, 3],), dtype=tp.float32), tp.InputInfo(([1, 2, 3],), dtype=tp.float32))</span>
<span class="sd">            print(compiled_add.get_output_info())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_signature</span><span class="o">.</span><span class="n">get_num_input_args</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_executable_signature</span><span class="o">.</span><span class="n">get_num_output_args</span><span class="p">()):</span>
            <span class="n">output_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_arg_info</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="n">offset</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">output_info</span></div>


<div class="viewcode-block" id="Executable.save">
<a class="viewcode-back" href="../../../compiler/executable.html#tripy.Executable.save">[docs]</a>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the compiled executable to the given file.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The name of file to save the executable.</span>

<span class="sd">        .. code-block:: python</span>
<span class="sd">            :linenos:</span>
<span class="sd">            :caption: Save executable</span>

<span class="sd">            import os, tempfile</span>

<span class="sd">            def add(a, b):</span>
<span class="sd">                return a + b</span>

<span class="sd">            # doc: no-print-locals compiler compiled_add executable_file</span>
<span class="sd">            compiler = tp.Compiler(add)</span>
<span class="sd">            compiled_add = compiler.compile(tp.InputInfo(([1, 2, 3],), dtype=tp.float32), tp.InputInfo(([1, 2, 3],), dtype=tp.float32))</span>

<span class="sd">            with tempfile.TemporaryDirectory() as temp_dir:</span>
<span class="sd">                executable_file = os.path.join(temp_dir, &quot;executable.json&quot;)</span>
<span class="sd">                compiled_add.save(executable_file)</span>
<span class="sd">                assert os.path.exists(executable_file)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">json_utils</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="Executable.load">
<a class="viewcode-back" href="../../../compiler/executable.html#tripy.Executable.load">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;tripy.Executable&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a compiled executable from a given directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The name of file to load the exectuable from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The executable object loaded from the file.</span>

<span class="sd">        .. code-block:: python</span>
<span class="sd">            :linenos:</span>
<span class="sd">            :caption: Save and load executable</span>

<span class="sd">            import os, tempfile</span>

<span class="sd">            def add(a, b):</span>
<span class="sd">                return a + b</span>

<span class="sd">            # doc: no-print-locals compiler compiled_add executable_file</span>
<span class="sd">            compiler = tp.Compiler(add)</span>
<span class="sd">            compiled_add = compiler.compile(tp.InputInfo(([1, 2, 3],), dtype=tp.float32), tp.InputInfo(([1, 2, 3],), dtype=tp.float32))</span>

<span class="sd">            with tempfile.TemporaryDirectory() as temp_dir:</span>
<span class="sd">                executable_file = os.path.join(temp_dir, &quot;executable.json&quot;)</span>
<span class="sd">                compiled_add.save(executable_file)</span>
<span class="sd">                assert os.path.exists(executable_file)</span>
<span class="sd">                loaded_executable = tp.Executable.load(executable_file)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json_utils</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>
</div>



<span class="nd">@json_utils</span><span class="o">.</span><span class="n">Encoder</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Executable</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">encode_executable</span><span class="p">(</span><span class="n">executable</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;arg_names&quot;</span><span class="p">:</span> <span class="n">executable</span><span class="o">.</span><span class="n">_arg_names</span><span class="p">,</span>
        <span class="s2">&quot;output_devices&quot;</span><span class="p">:</span> <span class="n">executable</span><span class="o">.</span><span class="n">_output_devices</span><span class="p">,</span>
        <span class="s2">&quot;executable&quot;</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">executable</span><span class="o">.</span><span class="n">_executable</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
    <span class="p">}</span>


<span class="nd">@json_utils</span><span class="o">.</span><span class="n">Decoder</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Executable</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">decode_executable</span><span class="p">(</span><span class="n">executable_dict</span><span class="p">):</span>
    <span class="n">executable_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">executable_dict</span><span class="p">[</span><span class="s2">&quot;executable&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">Executable</span><span class="p">(</span>
        <span class="n">runtime</span><span class="o">.</span><span class="n">Executable</span><span class="p">(</span><span class="n">executable_bytes</span><span class="p">),</span>
        <span class="n">executable_dict</span><span class="p">[</span><span class="s2">&quot;arg_names&quot;</span><span class="p">],</span>
        <span class="n">executable_dict</span><span class="p">[</span><span class="s2">&quot;output_devices&quot;</span><span class="p">],</span>
    <span class="p">)</span>


<span class="c1"># TODO (#230): Support collections of tensors in args/kwargs</span>
<div class="viewcode-block" id="Compiler">
<a class="viewcode-back" href="../../../compiler/index.html#tripy.Compiler">[docs]</a>
<span class="nd">@export</span><span class="o">.</span><span class="n">public_api</span><span class="p">(</span><span class="n">document_under</span><span class="o">=</span><span class="s2">&quot;compiler/index.rst&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Compiler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The compiler can compile Python functions into executables that run efficiently on the GPU.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">optimization_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            func: The function or :class:`Module` to optimize. The function must satisfy the following requirements:</span>

<span class="sd">                - Must be a pure function with no side effects.</span>
<span class="sd">                  This means, for example, that you cannot use ``print`` or ``assert``.</span>

<span class="sd">                - Must not accept variadic positional or keyword arguments.</span>

<span class="sd">                - Must return one or more :class:`Tensor` s and no other types.</span>

<span class="sd">                The compiled function will have the following constraints:</span>

<span class="sd">                - Only :class:`Tensor` parameters to the function can become runtime inputs. All other types of parameters,</span>
<span class="sd">                  even collections of :class:`Tensor` s (e.g. ``List[Tensor]`` or ``Dict[str, Tensor]``), will be baked into</span>
<span class="sd">                  the compiled function as constants.</span>

<span class="sd">            optimization_level: The optimization level to use when compiling. Higher optimization levels can lead to better</span>
<span class="sd">                runtime performance at the cost of longer compile times.</span>

<span class="sd">        .. code-block:: python</span>
<span class="sd">            :linenos:</span>
<span class="sd">            :caption: Example</span>

<span class="sd">            def add(a, b):</span>
<span class="sd">                return a + b</span>

<span class="sd">            # doc: no-print-locals compiler compiled_add</span>
<span class="sd">            compiler = tp.Compiler(add)</span>
<span class="sd">            compiled_add = compiler.compile(tp.InputInfo((1,), dtype=tp.float32), tp.InputInfo((1,), dtype=tp.float32))</span>

<span class="sd">            a = tp.ones((1,), dtype=tp.float32)</span>
<span class="sd">            b = tp.ones((1,), dtype=tp.float32)</span>

<span class="sd">            out = compiled_add(a, b)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimization_level</span> <span class="o">=</span> <span class="n">optimization_level</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
        <span class="c1"># TODO (#245): Support variadic arguments.</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">VAR_KEYWORD</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">VAR_POSITIONAL</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signature</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">raise_error</span><span class="p">(</span><span class="s2">&quot;Variadic positional/keyword arguments are not currently supported.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Compiler.compile">
<a class="viewcode-back" href="../../../compiler/index.html#tripy.Compiler.compile">[docs]</a>
    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Executable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compiles the function. This works by first calling the function with the provided arguments</span>
<span class="sd">        in order to trace its execution, and the compiling the resulting traced graph.</span>

<span class="sd">        Parameters that should be runtime inputs in the compiled function should be provided</span>
<span class="sd">        as :class:`InputInfo` arguments to this function instead of as :class:`Tensor` s. Arguments</span>
<span class="sd">        of any other type will be treated as compile-time constants.</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Positional arguments to forward to the target function while tracing.</span>
<span class="sd">            **kwargs: Keyword arguments to forward to the target function while tracing.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The compiled executable. This executable&#39;s parameters will be the subset of the original</span>
<span class="sd">            function&#39;s parameters for which :class:`InputInfo` s were provided to :func:`compile` and</span>
<span class="sd">            will only accept :class:`Tensor` arguments.</span>


<span class="sd">        .. code-block:: python</span>
<span class="sd">            :linenos:</span>
<span class="sd">            :caption: Dynamic Shapes</span>

<span class="sd">            def add(a, b):</span>
<span class="sd">                return a + b</span>

<span class="sd">            # doc: no-print-locals compiler compiled_add</span>
<span class="sd">            compiler = tp.Compiler(add)</span>
<span class="sd">            # Support shapes in the range of (1, 2) to (3, 2), optimizing for a shape of (2, 2)</span>
<span class="sd">            compiled_add = compiler.compile(tp.InputInfo(([1, 2, 3], 2), dtype=tp.float32), tp.InputInfo(([1, 2, 3], 2), dtype=tp.float32))</span>

<span class="sd">            small_a = tp.ones((1, 2), dtype=tp.float32)</span>
<span class="sd">            small_b = tp.ones((1, 2), dtype=tp.float32)</span>

<span class="sd">            small_out = compiled_add(small_a, small_b)</span>

<span class="sd">            # Now we can reuse the compiled function for any shapes within the range:</span>
<span class="sd">            big_a = tp.ones((3, 2), dtype=tp.float32)</span>
<span class="sd">            big_b = tp.ones((3, 2), dtype=tp.float32)</span>

<span class="sd">            big_out = compiled_add(big_a, big_b)</span>


<span class="sd">        .. code-block:: python</span>
<span class="sd">            :linenos:</span>
<span class="sd">            :caption: Baking Constants</span>

<span class="sd">            def add(a, b):</span>
<span class="sd">                return a + b</span>

<span class="sd">            # doc: no-print-locals compiler compiled_add</span>
<span class="sd">            compiler = tp.Compiler(add)</span>

<span class="sd">            # By using a non-InputInfo type (in this case, a Tensor) for the `b` argument to `compile`,</span>
<span class="sd">            # we are indicating that it is a compile-time constant. Consequently, the compiled function</span>
<span class="sd">            # will not accept `b` as an input.</span>
<span class="sd">            b = tp.ones((1,), dtype=tp.float32)</span>
<span class="sd">            compiled_add = compiler.compile(tp.InputInfo((1,), dtype=tp.float32), b)</span>

<span class="sd">            a = tp.ones((1,), dtype=tp.float32)</span>

<span class="sd">            # Note that we cannot provide `b` as an argument to the compiled function.</span>
<span class="sd">            out = compiled_add(a)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">trace_input_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">input_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">process_arg</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">InputInfo</span><span class="p">):</span>
                <span class="c1"># Make new tensors for tracing.</span>
                <span class="kn">from</span> <span class="nn">tripy.common.datatype</span> <span class="kn">import</span> <span class="n">floating</span><span class="p">,</span> <span class="n">integer</span>
                <span class="kn">from</span> <span class="nn">tripy.frontend.trace.ops.fill</span> <span class="kn">import</span> <span class="n">full</span>

                <span class="n">init_value</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">integer</span><span class="p">)</span> <span class="k">else</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">floating</span><span class="p">)</span> <span class="k">else</span> <span class="kc">True</span>
                <span class="n">tensor</span> <span class="o">=</span> <span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">arg</span><span class="o">.</span><span class="n">shape_bounds</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">init_value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">arg</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                <span class="n">tensor</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

                <span class="n">trace_input_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tensor</span>
                <span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">shape_bounds</span><span class="p">)</span>
                <span class="n">input_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">tensor</span>
            <span class="k">return</span> <span class="n">arg</span>

        <span class="n">new_args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_positional_arg_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">new_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process_arg</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arg</span><span class="p">))</span>

        <span class="n">new_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new_kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">process_arg</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>

        <span class="c1"># Figure out the signature of the compiled function. This should include only the arguments that were provided</span>
        <span class="c1"># as `InputInfo`s, but the order needs to match the signature of the original function.</span>
        <span class="n">compiled_arg_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signature</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">input_names</span><span class="p">]</span>

        <span class="n">trace_outputs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">make_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">new_args</span><span class="p">,</span> <span class="o">**</span><span class="n">new_kwargs</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">trace_outputs</span><span class="p">:</span>
            <span class="n">raise_error</span><span class="p">(</span>
                <span class="s2">&quot;Function must return 1 or more Tensors.&quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Return value was: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">trace_outputs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">out</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trace_outputs</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">):</span>
                <span class="n">raise_error</span><span class="p">(</span>
                    <span class="s2">&quot;Function must return 1 or more Tensors.&quot;</span><span class="p">,</span>
                    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Return value </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> was not a tensor: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                <span class="p">)</span>

        <span class="c1"># Order of trace inputs also needs to match that of the compiled_arg_names</span>
        <span class="n">trace_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">trace_input_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">compiled_arg_names</span><span class="p">]</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="n">trace_outputs</span><span class="p">,</span> <span class="n">trace_inputs</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">)</span>

        <span class="n">flat_ir</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">to_flat_ir</span><span class="p">()</span>
        <span class="n">mlir</span> <span class="o">=</span> <span class="n">flat_ir</span><span class="o">.</span><span class="n">to_mlir</span><span class="p">()</span>
        <span class="n">compiler</span> <span class="o">=</span> <span class="n">MLIRCompiler</span><span class="p">(</span><span class="n">trt_builder_opt_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization_level</span><span class="p">)</span>
        <span class="n">executable</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">mlir</span><span class="p">,</span> <span class="n">flat_ir</span><span class="o">=</span><span class="n">flat_ir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Executable</span><span class="p">(</span>
            <span class="n">executable</span><span class="p">,</span>
            <span class="n">compiled_arg_names</span><span class="p">,</span>
            <span class="n">output_devices</span><span class="o">=</span><span class="p">[</span><span class="n">out</span><span class="o">.</span><span class="n">device</span> <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="n">trace</span><span class="o">.</span><span class="n">outputs</span><span class="p">],</span>
        <span class="p">)</span></div>
</div>

</pre></div>
</article>
        
      </main>
    </div>

    <footer class="nftt-footer">
      
<nav id="paginator"></nav>

      <div class="py-5 px-4 px-md-3">
  <div class="container">
    

    <div class="row">
      <div class="col-lg-12 text-center">
        <a class="brand-text d-inline-flex align-items-center mb-2 text-decoration-none" href="/" aria-label="Nefertiti-for-Sphinx">
          <span class="fs-6 fw-bold">Tripy</span>
        </a>
        
          <ul class="list-unstyled small text-muted">
            <li>2024, NVIDIA</li>
          </ul>
        
        
      </div>
    </div>
  </div>
</div>
    </footer>
    <script src="../../../_static/documentation_options.js?v=d45e8c67"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>

    <script type="text/javascript" src="../../../_static/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="../../../_static/sphinx-nefertiti.min.js"></script>
    
  </body>
</html>