#include <cuda.h>
#include <cuda_runtime_api.h>

#include <cstdint>
#include <cstdio>

#include "MTRTRuntimeStatus.h"

extern CUstream unnamed_module_cuda_stream;

// Aggregated init/destroy helpers generated by the EmitC host backend.
int32_t unnamed_module_initialize_all();
void unnamed_module_destroy_all();

int32_t run();

int main() {
  // The generated code reads the stream from a global.
  unnamed_module_cuda_stream = nullptr;

  int32_t initRc = unnamed_module_initialize_all();
  if (initRc != 0) {
    // Best-effort: runtime stores a thread-local message for the last error.
    std::fprintf(stderr, "%s\n", mtrt::get_last_error_message());
    return initRc;
  }

  int32_t rc = run();

  unnamed_module_destroy_all();
  return rc;
}
